function thetaGMST(t){return TUTI=(t-2451545)/36525,theta=67310.54841+3164400184.812866*TUTI+.093104*TUTI*TUTI-62e-7*Math.pow(TUTI,3),theta>0?theta%=86400:theta%=-86400,theta/240}function sunVectorCalc(t){return TUTI=(t-2451545)/36525,lambdaMO=280.4606184+36000.77005361*TUTI,MO=357.5277233+35999.05034*TUTI,lambda_el=lambdaMO+1.914666471*Math.sin(MO*Math.PI/180)+.019994643*Math.sin(2*MO*Math.PI/180),epsilon=23.43929-.026008*TUTI,[[Math.cos(lambda_el*Math.PI/180)],[Math.cos(epsilon*Math.PI/180)*Math.sin(lambda_el*Math.PI/180)],[Math.sin(epsilon*Math.PI/180)*Math.sin(lambda_el*Math.PI/180)]]}function julianDateCalc(t){let a=t[0],o=t[1],h=t[2],n=t[3],s=t[4];return 367*a-Math.floor(7*(a+Math.floor((o+9)/12))/4)+Math.floor(275*o/9)+h+1721013.5+((0+s)/60+n)/24}function julianDateCalcStruct(t){return 367*t.year-Math.floor(7*(t.year+Math.floor((t.month+9)/12))/4)+Math.floor(275*t.month/9)+t.day+1721013.5+((t.second/60+t.minute)/60+t.hour)/24}function moonVectorCalc(t){return T=(t-2451545)/36525,lam=218.32+481267.8813*T+6.29*Math.sin((134.9+477198.85*T)*Math.PI/180)-1.27*Math.sin((259.2-413335.38*T)*Math.PI/180)+.66*Math.sin((235.7+890534.23*T)*Math.PI/180)+.21*Math.sin((269.9+954397.7*T)*Math.PI/180)-.19*Math.sin((357.5+35999.05*T)*Math.PI/180)-.11*Math.sin((186.6+966404.05*T)*Math.PI/180),phi=5.13*Math.sin((93.3+483202.03*T)*Math.PI/180)+.28*Math.sin((228.2+960400.87*T)*Math.PI/180)-.28*Math.sin((318.3+6003.18*T)*Math.PI/180)-.17*Math.sin((217.6-407332.2*T)*Math.PI/180),eps=23.439291-.0130042*T,[[Math.cos(phi*Math.PI/180)*Math.cos(lam*Math.PI/180)],[Math.cos(eps*Math.PI/180)*Math.cos(phi*Math.PI/180)*Math.sin(lam*Math.PI/180)-Math.sin(eps*Math.PI/180)*Math.sin(phi*Math.PI/180)],[Math.sin(eps*Math.PI/180)*Math.cos(phi*Math.PI/180)*Math.sin(lam*Math.PI/180)+Math.cos(eps*Math.PI/180)*Math.sin(phi*Math.PI/180)]]}function Coe2PosVel(t){let a=t[0]*(1-t[1]*t[1]),o=Math.cos(t[5]),h=Math.sin(t[5]),n=[[a*o/(1+t[1]*o)],[a*h/(1+t[1]*o)],[0]],s=Math.sqrt(398600.4418/a),e=[[-s*h],[(t[1]+o)*s],[0]],i=Math.cos(t[3]),M=Math.sin(t[3]),r=Math.cos(t[4]),c=Math.sin(t[4]),d=Math.cos(t[2]),l=Math.sin(t[2]),u=[[i*r-M*c*d,-i*c-M*r*d,M*l],[M*r+i*c*d,-M*c+i*r*d,-i*l],[c*l,r*l,d]];return[math.multiply(u,n),math.multiply(u,e)]}function PosVel2Coe(t){let a=398600.4418,o=[t[0][0][0],t[0][1][0],t[0][2][0]],h=[t[1][0][0],t[1][1][0],t[1][2][0]],n=math.norm(o),s=math.norm(h),e=math.cross(o,h),i=math.norm(e),M=math.cross([0,0,1],e),r=math.norm(M);r<1e-5&&(M=[1,0,0],r=1);let c=-a/2/(s*s/2-a/n),d=math.subtract(math.dotDivide(math.cross(h,e),[a,a,a]),math.dotDivide(o,[n,n,n])),l=math.norm(d);l<1e-8&&(d=[1,0,0],l=0);let u,m,P=Math.aMath.cos(math.dot(e,[0,0,1])/i),x=Math.aMath.cos(math.dot(M,[1,0,0])/r);return M[1]<0&&(x=2*Math.PI-x),u=0===l?0:Math.aMath.cos(math.dot(M,d)/l/r),d[1]<0&&(u=2*Math.PI-u),m=0===l?Math.aMath.cos(math.dot(o,d)/n):Math.aMath.cos(math.dot(o,d)/n/l),o[1]<0&&(m=2*Math.PI-m),Number.isNaN(m)&&(m=math.dot(o,d)<0?Math.PI:0),[c,l,P,x,u,m]}function True2Eccentric(t,a){return 2*Math.atan(Math.sqrt((1-t)/(1+t))*Math.tan(a/2))}function Eccentric2True(t,a){return 2*Math.atan(Math.sqrt((1+t)/(1-t))*Math.tan(a/2))}function solveKeplersEquation(t,a){let o=t,h=1;for(;Math.abs(h)>1e-6;)o-=h=(o-a*Math.sin(o)-t)/(1-a*Math.cos(o));return o}function twoBodyProp(t,a){let o=Math.sqrt(398600.4418/t[0]/t[0]/t[0]),h=True2Eccentric(t[1],t[5]),n=h-t[1]*Math.sin(h);return"apogee"===a?a=(Math.PI-n)/o:"perigee"===a&&(a=(2*Math.PI-n)/o),h=solveKeplersEquation(n+=o*a,t[1]),t[5]=Eccentric2True(t[1],h),t}function RotMat(t,a,o=!1){o&&(a*=Math.PI/180);let h=Math.cos(a),n=Math.sin(a);return 1===t?[[1,0,0],[0,h,n],[0,-n,h]]:2===t?[[h,0,n],[0,1,0],[-n,0,h]]:[[h,-n,0],[n,h,0],[0,0,1]]}function Eci2Ecef(t,a){let o=RotMat(3,-t,"degrees");return math.multiply(o,a)}function PhiRR(t,a=2*Math.PI/86164){let o=a*t;return[[4-3*Math.cos(o),0],[6*(Math.sin(o)-o),1]]}function PhiRV(t,a=2*Math.PI/86164){let o=a*t;return[[Math.sin(o)/a,2*(1-Math.cos(o))/a],[2*(Math.cos(o)-1)/a,(4*Math.sin(o)-3*o)/a]]}function PhiVR(t,a=2*Math.PI/86164){let o=a*t;return[[3*a*Math.sin(o),0],[6*a*(Math.cos(o)-1),0]]}function PhiVV(t,a=2*Math.PI/86164){let o=a*t;return[[Math.cos(o),2*Math.sin(o)],[-2*Math.sin(o),4*Math.cos(o)-3]]}function PhiRR3d(t,a){void 0===a&&(a=2*Math.PI/86164);let o=a*t;return[[4-3*Math.cos(o),0,0],[6*(Math.sin(o)-o),1,0],[0,0,Math.cos(o)]]}function PhiRV3d(t,a){void 0===a&&(a=2*Math.PI/86164);let o=a*t;return[[Math.sin(o)/a,2*(1-Math.cos(o))/a,0],[2*(Math.cos(o)-1)/a,(4*Math.sin(o)-3*o)/a,0],[0,0,Math.sin(o)/a]]}function PhiVR3d(t,a){void 0===a&&(a=2*Math.PI/86164);let o=a*t;return[[3*a*Math.sin(o),0,0],[6*a*(Math.cos(o)-1),0,0],[0,0,-a*Math.sin(o)]]}function PhiVV3d(t,a){void 0===a&&(a=2*Math.PI/86164);let o=a*t;return[[Math.cos(o),2*Math.sin(o),0],[-2*Math.sin(o),4*Math.cos(o)-3,0],[0,0,Math.cos(o)]]}function rmoe2state(t,a,o){return t.length<5&&(t.push(0),t.push(0)),void 0===a&&(a=2*Math.PI/86164),o&&(t[3]*=Math.PI/180,t[5]*=Math.PI/180),[[-t[0]/2*Math.cos(t[3])+t[1]],[t[0]*Math.sin(t[3])+t[2]],[t[4]*Math.sin(t[5])],[t[0]*a/2*Math.sin(t[3])],[t[0]*a*Math.cos(t[3])-1.5*t[1]*a],[t[4]*a*Math.cos(t[5])]]}function state2rmoe(t,a,o){}function groundSwath(t,a){return a?180*Math.aMath.cos(6371/t)/Math.PI:Math.aMath.cos(6371/t)}function hcwEquations(t,a,o){if(void 0===o&&(o=2*Math.PI/86164),void 0===a&&(a=[0,0,0]),void 0===t[4])return[[t[1][0]],[3*o*o*t[0][0]+2*o*t[3][0]+a[0]],[t[3][0]],[-2*o*t[1][0]+a[1]]]}function hcwBurnClosed(t,a,o,h,n){void 0===n&&(n=2*Math.PI/86164);let s,e,i,M,r=t.x,c=t.y,d=t.xd,l=t.yd;return s=radialPosClosed(r,d,l,a,o,0,h,n),i=radialVelClosed(r,d,l,a,o,0,h,n),[s,e=intrackPosClosed(r,d,c,l,a,o,0,h,n),i,M=intrackVelClosed(r,d,l,a,o,0,h,n)]}function oneBurnFiniteHcw(t,a,o,h,n,s,e){void 0===e&&(e=2*Math.PI/86164),x0=t.x,xd0=t.xd,y0=t.y,yd0=t.yd,z0=t.z,zd0=t.zd,console.log(x0,y0,z0);let i=radialPosClosed(x0,xd0,yd0,s,a,o,h*n,e),M=radialVelClosed(x0,xd0,yd0,s,a,o,h*n,e),r=intrackPosClosed(x0,xd0,y0,yd0,s,a,o,h*n,e),c=intrackVelClosed(x0,xd0,yd0,s,a,o,h*n,e),d=crosstrackPosClosed(z0,zd0,s,o,h*n,e),l=crosstrackVelClosed(z0,zd0,s,o,h*n,e),u=radialPosClosed(i,M,c,0,0,0,n-h*n,e),m=radialVelClosed(i,M,c,0,0,0,n-h*n,e),P=intrackPosClosed(i,M,r,c,0,0,0,n-h*n,e),x=intrackVelClosed(i,M,c,0,0,0,n-h*n,e);return{x:u,y:P,z:crosstrackPosClosed(d,l,0,0,n-h*n,e),xd:m,yd:x,zd:crosstrackVelClosed(d,l,0,0,n-h*n,e)}}function twoBurnFiniteHcw(t,a,o,h,n,s,e,i,M,r){void 0===r&&(r=2*Math.PI/86164),x0=t.x,xd0=t.xd,y0=t.y,yd0=t.yd,z0=t.z,zd0=t.zd;let c=s*i,d=i-s*i-e*i,l=e*i,u=radialPosClosed(x0,xd0,yd0,M,a,o,c,r),m=radialVelClosed(x0,xd0,yd0,M,a,o,c,r),P=intrackPosClosed(x0,xd0,y0,yd0,M,a,o,c,r),x=intrackVelClosed(x0,xd0,yd0,M,a,o,c,r),y=crosstrackPosClosed(z0,zd0,M,o,c,r),p=crosstrackVelClosed(z0,zd0,M,o,c,r),z=radialPosClosed(u,m,x,0,0,0,d,r),w=radialVelClosed(u,m,x,0,0,0,d,r),I=intrackPosClosed(u,m,P,x,0,0,0,d,r),C=intrackVelClosed(u,m,x,0,0,0,d,r),f=crosstrackPosClosed(y,p,0,0,d,r),T=crosstrackVelClosed(y,p,0,0,d,r),V=radialPosClosed(z,w,C,M,h,n,l,r),v=radialVelClosed(z,w,C,M,h,n,l,r),k=intrackPosClosed(z,w,I,C,M,h,n,l,r),B=intrackVelClosed(z,w,C,M,h,n,l,r);return{x:V,y:k,z:crosstrackPosClosed(f,T,M,n,l,r),xd:v,yd:B,zd:crosstrackVelClosed(f,T,M,n,l,r)}}function radialPosClosed(t,a,o,h,n,s,e,i){return(4*Math.pow(i,2)*t+2*i*o-3*Math.pow(i,2)*t*Math.cos(i*e)-2*i*o*Math.cos(i*e)-h*Math.cos(n)*Math.cos(s)*Math.cos(i*e)+h*Math.cos(n)*Math.cos(s)*Math.pow(Math.cos(i*e),2)+2*h*i*e*Math.cos(s)*Math.sin(n)+i*a*Math.sin(i*e)-2*h*Math.cos(s)*Math.sin(n)*Math.sin(i*e)+h*Math.cos(n)*Math.cos(s)*Math.pow(Math.sin(i*e),2))/Math.pow(i,2)}function intrackPosClosed(t,a,o,h,n,s,e,i,M){return(-12*Math.pow(M,3)*i*t-4*M*a+2*Math.pow(M,2)*o-6*Math.pow(M,2)*i*h-4*n*M*i*Math.cos(s)*Math.cos(e)+4*M*a*Math.cos(M*i)-3*n*Math.pow(M,2)*Math.pow(i,2)*Math.cos(e)*Math.sin(s)-8*n*Math.cos(e)*Math.cos(M*i)*Math.sin(s)+8*n*Math.cos(e)*Math.pow(Math.cos(M*i),2)*Math.sin(s)+12*Math.pow(M,2)*t*Math.sin(M*i)+8*M*h*Math.sin(M*i)+4*n*Math.cos(s)*Math.cos(e)*Math.sin(M*i)+8*n*Math.cos(e)*Math.sin(s)*Math.pow(Math.sin(M*i),2))/(2*Math.pow(M,2))}function crosstrackPosClosed(t,a,o,h,n,s){return(Math.pow(s,2)*t*Math.cos(s*n)+o*Math.sin(h)-o*Math.cos(s*n)*Math.sin(h)+s*a*Math.sin(s*n))/Math.pow(s,2)}function radialVelClosed(t,a,o,h,n,s,e,i){return(Math.pow(i,2)*a*Math.cos(i*e)+2*h*i*Math.cos(s)*Math.sin(n)-2*h*i*Math.cos(s)*Math.cos(i*e)*Math.sin(n)+3*Math.pow(i,3)*t*Math.sin(i*e)+2*Math.pow(i,2)*o*Math.sin(i*e)+h*i*Math.cos(n)*Math.cos(s)*Math.sin(i*e))/Math.pow(i,2)}function intrackVelClosed(t,a,o,h,n,s,e,i){return(-12*Math.pow(i,3)*t-6*Math.pow(i,2)*o-4*h*i*Math.cos(n)*Math.cos(s)+12*Math.pow(i,3)*t*Math.cos(i*e)+8*Math.pow(i,2)*o*Math.cos(i*e)+4*h*i*Math.cos(n)*Math.cos(s)*Math.cos(i*e)-6*h*Math.pow(i,2)*e*Math.cos(s)*Math.sin(n)-4*Math.pow(i,2)*a*Math.sin(i*e)+8*h*i*Math.cos(s)*Math.sin(n)*Math.sin(i*e))/(2*Math.pow(i,2))}function crosstrackVelClosed(t,a,o,h,n,s){return(Math.pow(s,2)*a*Math.cos(s*n)-Math.pow(s,3)*t*Math.sin(s*n)+o*s*Math.sin(h)*Math.sin(s*n))/Math.pow(s,2)}function hcwFiniteBurnOneBurn(t,a,o,h,n){void 0===o&&(o=2*Math.PI/86164),state=[[t.x],[t.y],[t.z],[t.xd],[t.yd],[t.zd]],a=[[a.x],[a.y],[a.z],[a.xd],[a.yd],[a.zd]];let s,e,i,M,r=proxOpsTargeter(state.slice(0,3),a.slice(0,3),h)[0],c=1,d=math.subtract(r,state.slice(3,6)),l=[[Math.atan2(d[1][0],d[0][0])],[Math.atan2(d[2],math.norm([d[0][0],d[1][0]]))],[math.norm(math.squeeze(d))/n/h]];if(M=l,l[2]>1)return[!1,0];let u=0;for(;math.norm(math.squeeze(c))>1e-6;){if(i=oneBurnFiniteHcw(t,l[0][0],l[1][0],l[2][0],h,n,o),s=[[a[0][0]-i.x],[a[1][0]-i.y],[a[2][0]-i.z]],e=proxOpsJacobianOneBurn(t,n,l[0][0],l[1][0],l[2][0],h,o),c=math.multiply(math.inv(e),s),console.log(l,i),l=math.add(l,c),u>30)return console.log(l),[!1,0];u++}return[l,M]}function hcwFiniteBurnTwoBurn(t,a,o,h,n){void 0===o&&(o=2*Math.PI/86164),state=[[t.x],[t.y],[t.z],[t.xd],[t.yd],[t.zd]],a=[[a.x],[a.y],[a.z],[a.xd],[a.yd],[a.zd]];let s,e,i,M,r,c=proxOpsTargeter(state.slice(0,3),a.slice(0,3),h),d=c[0],l=c[1],u=1,m=0,P=math.subtract(d,state.slice(3,6)),x=math.subtract(state.slice(3,6),l),y=[[Math.atan2(P[1][0],P[0][0])],[Math.atan2(P[2],math.norm([P[0][0],P[1][0]]))],[math.norm(math.squeeze(P))/n/h],[Math.atan2(x[1][0],x[0][0])],[Math.atan2(x[2],math.norm([x[0][0],x[1][0]]))],[math.norm(math.squeeze(x))/n/h]];for(;math.norm(math.squeeze(u))>1e-6&&(i=twoBurnFiniteHcw(t,y[0][0],y[1][0],y[3][0],y[4][0],y[2][0],y[5][0],h,n,o),s=[[a[0][0]-i.x],[a[1][0]-i.y],[a[2][0]-i.z],[a[3][0]-i.xd],[a[4][0]-i.yd],[a[5][0]-i.zd]],e=proxOpsJacobianTwoBurn(t,n,y[0][0],y[1][0],y[2][0],y[3][0],y[4][0],y[5][0],h,o),r=math.inv(math.multiply(e,math.transpose(e))),M=math.multiply(math.transpose(e),r),u=math.multiply(M,s),console.log(i),y=math.add(y,u),!(++m>50)););return y}function oneBurnFiniteHcw(t,a,o,h,n,s,e){void 0===e&&(e=2*Math.PI/86164),x0=t.x,xd0=t.xd,y0=t.y,yd0=t.yd,z0=t.z,zd0=t.zd;let i=radialPosClosed(x0,xd0,yd0,s,a,o,h*n,e),M=radialVelClosed(x0,xd0,yd0,s,a,o,h*n,e),r=intrackPosClosed(x0,xd0,y0,yd0,s,a,o,h*n,e),c=intrackVelClosed(x0,xd0,yd0,s,a,o,h*n,e),d=crosstrackPosClosed(z0,zd0,s,o,h*n,e),l=crosstrackVelClosed(z0,zd0,s,o,h*n,e),u=radialPosClosed(i,M,c,0,0,0,n-h*n,e),m=radialVelClosed(i,M,c,0,0,0,n-h*n,e),P=intrackPosClosed(i,M,r,c,0,0,0,n-h*n,e),x=intrackVelClosed(i,M,c,0,0,0,n-h*n,e);return{x:u,y:P,z:crosstrackPosClosed(d,l,0,0,n-h*n,e),xd:m,yd:x,zd:crosstrackVelClosed(d,l,0,0,n-h*n,e)}}function proxOpsTargeter(t,a,o){return v1=math.multiply(math.inv(PhiRV3d(o)),math.subtract(a,math.multiply(PhiRR3d(o),t))),v2=math.add(math.multiply(PhiVR3d(o),t),math.multiply(PhiVV3d(o),v1)),[v1,v2]}function proxOpsJacobianOneBurn(t,a,o,h,n,s,e){let i,M,r,c=[];return i=[[(i=oneBurnFiniteHcw(t,o,h,n,s,a,e)).x],[i.y],[i.z]],M=[[(M=oneBurnFiniteHcw(t,o+.01,h,n,s,a,e)).x],[M.y],[M.z]],c=r=math.dotDivide(math.subtract(M,i),.01),i=[[(i=oneBurnFiniteHcw(t,o,h,n,s,a,e)).x],[i.y],[i.z]],M=[[(M=oneBurnFiniteHcw(t,o,h+.01,n,s,a,e)).x],[M.y],[M.z]],m=math.dotDivide(math.subtract(M,i),.01),r=math.concat(r,m),i=[[(i=oneBurnFiniteHcw(t,o,h,n,s,a,e)).x],[i.y],[i.z]],M=[[(M=oneBurnFiniteHcw(t,o,h,n+.01,s,a,e)).x],[M.y],[M.z]],m=math.dotDivide(math.subtract(M,i),.01),r=math.concat(r,m)}function proxOpsJacobianTwoBurn(t,a,o,h,n,s,e,i,M,r){let c,d,l,u=[];return c=[[(c=twoBurnFiniteHcw(t,o,h,s,e,n,i,M,a,r)).x],[c.y],[c.z],[c.xd],[c.yd],[c.zd]],d=[[(d=twoBurnFiniteHcw(t,o+1e-4,h,s,e,n,i,M,a,r)).x],[d.y],[d.z],[d.xd],[d.yd],[d.zd]],u=l=math.dotDivide(math.subtract(d,c),1e-4),c=[[(c=twoBurnFiniteHcw(t,o,h,s,e,n,i,M,a,r)).x],[c.y],[c.z],[c.xd],[c.yd],[c.zd]],d=[[(d=twoBurnFiniteHcw(t,o,h+1e-4,s,e,n,i,M,a,r)).x],[d.y],[d.z],[d.xd],[d.yd],[d.zd]],l=math.dotDivide(math.subtract(d,c),1e-4),u=math.concat(u,l),c=[[(c=twoBurnFiniteHcw(t,o,h,s,e,n,i,M,a,r)).x],[c.y],[c.z],[c.xd],[c.yd],[c.zd]],d=[[(d=twoBurnFiniteHcw(t,o,h,s,e,n+1e-4,i,M,a,r)).x],[d.y],[d.z],[d.xd],[d.yd],[d.zd]],l=math.dotDivide(math.subtract(d,c),1e-4),u=math.concat(u,l),c=[[(c=twoBurnFiniteHcw(t,o,h,s,e,n,i,M,a,r)).x],[c.y],[c.z],[c.xd],[c.yd],[c.zd]],d=[[(d=twoBurnFiniteHcw(t,o,h,s+1e-4,e,n,i,M,a,r)).x],[d.y],[d.z],[d.xd],[d.yd],[d.zd]],l=math.dotDivide(math.subtract(d,c),1e-4),u=math.concat(u,l),c=[[(c=twoBurnFiniteHcw(t,o,h,s,e,n,i,M,a,r)).x],[c.y],[c.z],[c.xd],[c.yd],[c.zd]],d=[[(d=twoBurnFiniteHcw(t,o,h,s,e+1e-4,n,i,M,a,r)).x],[d.y],[d.z],[d.xd],[d.yd],[d.zd]],l=math.dotDivide(math.subtract(d,c),1e-4),u=math.concat(u,l),c=[[(c=twoBurnFiniteHcw(t,o,h,s,e,n,i,M,a,r)).x],[c.y],[c.z],[c.xd],[c.yd],[c.zd]],d=[[(d=twoBurnFiniteHcw(t,o,h,s,e,n,i+1e-4,M,a,r)).x],[d.y],[d.z],[d.xd],[d.yd],[d.zd]],l=math.dotDivide(math.subtract(d,c),1e-4),u=math.concat(u,l)}function multiplyMatrix(t,a){let o,h=math.zeros(math.size(t));for(var n=0;n<t.length;n++)for(var s=0;s<t.length;s++){o=0;for(var e=0;e<t.length;e++)o+=t[n][e]*a[e][s];h[n][s]=o}return h}