<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <script src="./SupportLibraries/Chart.bundle.min.js"></script>
    <script src="./SupportLibraries/math.min.js"></script>
    <script src="./SupportLibraries/vue.js"></script>
    <title>RMOE</title>
	<style>
		.navbar {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1f3a52;
        }
        body {
            min-height: 300px;
            background: #06090c;
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#111b24', endColorstr='#0c4161',GradientType=0 );
            height: 100%;
            font-family: "open_sansregular";
                color: rgb(201, 203, 206);
            overflow-x: hidden;
            /* Panel opening and closing animation time - 200mx */
            transition: transform .2s;
            -webkit-transition: -webkit-transform .2s;
        }
        
        li {
            float: left;
        }
        li p {
            display: block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            font-size: 5vh;
        }
        #sliderApp {
            padding: 0% 2.5%;
        }
		.slider {
			width: 100%;
		}
		.slidercontainer {
            font-size: 3vh;
            background-color: #1f3a52;
			/* background-color: rgb(100,100,100); */
			opacity: 0.75;
		}
		.slidercontainer:hover {
			opacity: 1;
		}
        .inplanecontainer {
            padding: 0.5% 1%;
        }
        #setup:hover:not(.active) {
            cursor: pointer;
		}
        #playButton {
            position: fixed;
            top: 3%;
            right: 5%;
            width: 15%;
            text-align: center;
            border: 1px solid white;
            padding: 10px;
            font-size: 1.8vw;
        }
        #playButton:hover {
            background-color: rgba(255, 255, 255, 0.125);
            cursor: pointer;
        }
	</style>
  </head>
  <body>
    <ul class="navbar">
        <li><p id="navTitle">Relative Motion Orbital Elements</p></li>
    </ul>
	<div class="row sticky-top" id="sliderApp">
        <p id="playButton" @click="playScene">{{playText}}</p>
        <slider-input :element="'Ae'" :invalue="ae" :mn="0" :mx="20"   :dsbld="playBool" v-on:value-change="updateScreen"></slider-input>
        <slider-input :element="'Xd'" :invalue="xd" :mn="-20" :mx="20" :dsbld="playBool" v-on:value-change="updateScreen"></slider-input>
        <slider-input :element="'Yd'" :invalue="yd" :mn="-20" :mx="20" :dsbld="playBool" v-on:value-change="updateScreen"></slider-input>
        <slider-input :element="'B'" :invalue="b" :mn="0" :mx="360"   :dsbld="playBool" v-on:value-change="updateScreen"></slider-input>
        <slider-input :element="'Zmax'" :invalue="zmax" :mn="-15" :mx="15" :dsbld="playBool" v-on:value-change="updateScreen"></slider-input>
        <slider-input :element="'M'" :invalue="m" :mn="0" :mx="360"     :dsbld="playBool" v-on:value-change="updateScreen"></slider-input>
	</div>
	<div class="row">
        <div class="col-8 inplanecontainer">
            <canvas id="ChartCnvs3" width="12" height="7"></canvas>
        </div>
		<div class="col-4 inplanecontainer">
            <div><canvas id="ChartCnvs1" width="12" height="7"></canvas></div>
            <div><canvas id="ChartCnvs2" width="12" height="7"></canvas></div>
		</div>
    </div>
    
    <script>
        Vue.component('slider-input', {
            props: ['element','invalue','mn','mx','dsbld'],
            data: function() {
                return {playBool: false, rmoeVar: this.invalue}
            },
            template: '<div class="col-xl-2 col-md-6 slidercontainer">\
                <p> {{element}}: {{rmoeVar.toFixed(2)}} km </p>\
                <input v-model.number="rmoeVar" type="range" class="slider" :min="mn" :max="mx" step="0.01" :disabled="dsbld" >\
                </div>',
            watch: {
                rmoeVar: function() {
                    this.$emit('value-change',[this.element, this.rmoeVar]);
                },
                invalue: function() {
                    this.rmoeVar = this.invalue;
                }
            }
        })

        var app = new Vue({
            el: '#sliderApp',
            created() {
                window.addEventListener('keydown', e => {if (e.key.toLowerCase() === 'p') {this.playScene();}});
            },
            data: {
                ae: 0,
                xd: 0,
                yd: 0,
                b:  0,
                zmax: 0,
                m: 0,
                rmoes: {
                    ae: {
                        min: 0,
                        max: 20,
                        value: 0,
                        units: 'km',
                        name: 'ae',
                        inHtml: 'A<sub>e</sub>'
                    },
                    xd: {
                        min: -20,
                        max: 20,
                        value: 0,
                        units: 'km',
                        name: 'xd',
                        inHtml: 'X<sub>d</sub>'
                    },
                    yd: {
                        min: -20,
                        max: 20,
                        value: 0,
                        units: 'km',
                        name: 'ae',
                        inHtml: 'Y<sub>d</sub>'
                    },
                    b: {
                        min: 0,
                        max: 360,
                        value: 0,
                        units: 'km',
                        name: 'ae',
                        inHtml: 'B'
                    },
                    zmax: {
                        min: 0,
                        max: 20,
                        value: 0,
                        units: 'km',
                        name: 'ae',
                        inHtml: 'Z<sub>max</sub>'
                    },
                    m: {
                        min: 0,
                        max: 360,
                        value: 0,
                        units: 'deg',
                        name: 'm',
                        inHtml: 'M'
                    }
                },
                playBool: false,
                playText: '[P]lay Scene'
            },
            methods: {
                updateScreen: function($event) {
                    this[$event[0].toLowerCase()] = $event[1];
                },
                playScene: function() {
                    if (!this.playBool) {
                        this.playBool = true;
                        this.playText = 'Stop Scene';
                    }
                    else {
                        this.playBool = false;
                        this.playText = '[P]lay Scene';
                        return;
                    }
                    let nPlay = 2*Math.PI/86164;
                    let bOld = app.b + 0;
                    let mOld = app.m + 0;
                    let ydOld = app.yd + 0;
                    let rPlay = [[-app.ae/2*Math.cos(app.b * Math.PI / 180)+app.xd],[app.ae*Math.sin(app.b * Math.PI / 180)+app.yd],[app.zmax*Math.sin(app.m * Math.PI / 180)]];
                    let vPlay = [[app.ae*nPlay/2*Math.sin(app.b * Math.PI / 180)],[app.ae*nPlay*Math.cos(app.b * Math.PI / 180)-1.5*app.xd*nPlay],[app.zmax*nPlay*Math.cos(app.m * Math.PI / 180)]];
                    let dtPlay = 500;
                    let playRR = PhiRR(dtPlay,nPlay); let playRV = PhiRV(dtPlay,nPlay); 
                    let playVR = PhiVR(dtPlay,nPlay); let playVV = PhiVV(dtPlay,nPlay); 
                    globalChartRef3.config.data.datasets[0].data = [];
                    globalChartRef1.config.data.datasets[0].data = [];
                    globalChartRef3.config.data.datasets[0].data.push({
                        x: rPlay[1][0],
                        y: rPlay[0][0]
                    })
                    globalChartRef1.config.data.datasets[0].data.push({
                        x: rPlay[1][0],
                        y: rPlay[2][0]
                    })
                    let idInterval = setInterval(() => {
                        let rPlayT = math.add(math.multiply(playRR,rPlay),math.multiply(playRV,vPlay));
                        vPlay = math.add(math.multiply(playVR,rPlay),math.multiply(playVV,vPlay));
                        app.yd -= 3/2*app.xd*nPlay*dtPlay;
                        app.b += nPlay*dtPlay*180/Math.PI;
                        app.b = app.b > 360 ? app.b - 360 : app.b;
                        app.m += nPlay*dtPlay*180/Math.PI;
                        app.m = app.m > 360 ? app.m - 360 : app.m;
                        createEllipse(app.yd,app.xd,app.ae,app.b*Math.PI/180);
                        rPlay = rPlayT;
                        globalChartRef3.config.data.datasets[0].data.push({
                            x: rPlay[1][0],
                            y: rPlay[0][0]
                        })
                        globalChartRef1.config.data.datasets[0].data.push({
                            x: rPlay[1][0],
                            y: rPlay[2][0]
                        })
                        if ((app.ae+Math.abs(app.yd)) > axisLimits) {
                            axisCenter += -3/2*app.xd*nPlay*dtPlay;
                        }
                        resetAxisSize();
                        globalChartRef3.config.data.datasets[1].data[0].x = rPlay[1][0];
                        globalChartRef3.config.data.datasets[1].data[0].y = rPlay[0][0];
                        globalChartRef2.config.data.datasets[1].data[0].x = rPlay[0][0];
                        globalChartRef2.config.data.datasets[1].data[0].y = rPlay[2][0];
                        globalChartRef1.config.data.datasets[1].data[0].x = rPlay[1][0];
                        globalChartRef1.config.data.datasets[1].data[0].y = rPlay[2][0];
                        globalChartRef3.update();
                        globalChartRef2.update();
                        globalChartRef1.update();
                        if (!this.playBool) {
                            app.b = bOld;
                            app.yd = ydOld;
                            app.m = mOld;
                            axisCenter = 0;
                            resetAxisSize();
                            calculateTrajecories();
                            clearInterval(idInterval);
                        }
                    }, 25);
                }
            },
                
            watch: {
                ae: () => calculateTrajecories(),
                xd: () => calculateTrajecories(),
                yd: () => calculateTrajecories(),
                b: () => calculateTrajecories(),
                zmax: () => calculateTrajecories(),
                m: () => calculateTrajecories(),
            }
        })
    </script>
	
	<script src="./js/rmoeVis2d.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
   
  </body>
</html>